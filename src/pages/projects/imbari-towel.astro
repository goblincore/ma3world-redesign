---
import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import ButterflyLoader from '../../components/ButterflyLoader.astro';

const project = {
  title: "Imabari Towel Digital Art Gallery",
  titleJa: "今治タオル デジタルアートギャラリー",
  category: "Digital Innovation / Art",
  year: "2024",
  description: "A hybrid cultural innovation project that transforms digital creativity into physical products, exhibitions, and sustainable economic value. This gallery bridges global artists and local industries, developing avatars, products, and collaborative platforms that enable cultural circulation.",
  descriptionJa: "デジタルの創造性を物理的な製品、展示、そして持続可能な経済価値へと変革するハイブリッドなカルチャー・イノベーション・プロジェクト。このギャラリーは世界のクリエイターと地域の産業を繋ぎ、文化の循環を可能にするアバター、製品、コラボレーションプラットフォームを開発しています。",
  mainImage: "/src/assets/imabari_hero.png" // We'll move the generated image here or reference it properly
};
---

<Layout title={`${project.title} | MA3.0 World`}>
  <Header transparent={false} />
  
  <main class="bg-theme overflow-hidden">
    <!-- Hero Section with Video Background -->
    <section class="project-hero relative h-[100svh] flex items-end pb-12 md:pb-24 px-6 md:px-12 overflow-hidden bg-theme">
      <!-- Video Background -->
      <div class="absolute inset-0 z-0">
        <video 
          id="project-video"
          src="/video/imabariditigalartgallery.mp4" 
          autoplay 
          loop 
          muted 
          playsinline 
          class="w-full h-full object-cover opacity-0 transition-opacity duration-1000"
        ></video>
        <!-- Theme-aware Overlay for Legibility -->
        <div class="hero-overlay absolute inset-0 z-10 transition-opacity duration-700"></div>
        <div class="absolute inset-x-0 top-0 h-64 hero-top-gradient z-20 pointer-events-none"></div>
        <!-- Initial Loading Overlay -->
        <div id="video-loader" class="absolute inset-0 bg-theme z-20 transition-opacity duration-1000">
          <ButterflyLoader />
        </div>
      </div>

      <!-- Content Overlay -->
      <div class="relative z-10 max-w-7xl w-full mx-auto">
        <div class="max-w-4xl space-y-6">
          <span class="hero-text-muted text-[10px] md:text-xs tracking-[0.4em] uppercase font-bold block mb-4">
            {project.category}
          </span>
          <h1 class="hero-text font-serif text-5xl md:text-8xl lg:text-9xl leading-[0.9]">
            <span class="lang-en">{project.title}</span>
            <span class="lang-ja">{project.titleJa}</span>
          </h1>
          
          <div class="flex flex-wrap items-center gap-x-8 gap-y-4 pt-8 border-t hero-border">
            <div class="flex items-center gap-3">
              <span class="hero-text-muted text-[10px] uppercase tracking-[0.3em] font-bold">Client</span>
              <span class="hero-text-soft text-sm md:text-base">Imabari Towel</span>
            </div>
            <div class="flex items-center gap-3">
              <span class="hero-text-muted text-[10px] uppercase tracking-[0.3em] font-bold">Year</span>
              <span class="hero-text-soft text-sm md:text-base">{project.year}</span>
            </div>
            <p class="hero-text-muted text-[10px] md:text-xs tracking-widest uppercase ml-auto">
              Presented by MA3.0 World
            </p>
          </div>
        </div>
      </div>
    </section>
    <!-- Project Concept Section -->
    <section class="py-32 md:py-48 px-6 md:px-12 flex justify-center border-b border-theme/10">
      <div class="max-w-4xl w-full space-y-16">
        <h2 class="font-serif text-3xl md:text-5xl border-l-2 border-theme/30 pl-8">
          <span class="lang-en">Innovating the sacred land of towel-making.</span>
          <span class="lang-ja">タオルづくりの聖地に新たな息吹を。</span>
        </h2>
        
        <div class="max-w-none text-xl md:text-2xl leading-relaxed text-theme-muted space-y-8">
          <p>
            <span class="lang-en">{project.description}</span>
            <span class="lang-ja">{project.descriptionJa}</span>
          </p>
          <p>
            <span class="lang-en">For 130 years, Imabari has been celebrated as the sacred land of towel production, synonymous with "Safety, Peace of Mind, and High Quality." This project represents the next phase of the Imabari Towel Project, taking the tradition into the digital realm.</span>
            <span class="lang-ja">130年に亘り「安心・安全・高品質」なタオルを製造してきた“タオルづくりの聖地”今治。本プロジェクトは、2006年から続く「今治タオルプロジェクト」の次なるフェーズとして、伝統をデジタル空間へと拡張する試みです。</span>
          </p>
        </div>
        
        <div class="pt-16 border-t border-theme/10 flex flex-col md:flex-row justify-between items-center gap-8">
          <a href="https://www.imabaritowel.jp/digital-art-gallery/" target="_blank" class="group relative px-12 py-6 border border-theme/20 overflow-hidden">
            <div class="absolute inset-0 bg-theme translate-y-full group-hover:translate-y-0 transition-transform duration-500"></div>
            <span class="relative z-10 text-xs font-bold uppercase tracking-widest group-hover:text-theme-alt transition-colors">
              <span class="lang-en">Visit Virtual Gallery</span>
              <span class="lang-ja">バーチャルギャラリーを訪ねる</span>
            </span>
          </a>
          
          <a href="/#projects" class="text-sm uppercase tracking-widest opacity-60 hover:opacity-100 transition-opacity flex items-center gap-4">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" class="rotate-180">
              <path d="M5 12H19M19 12L12 5M19 12L12 19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="lang-en">Back to Projects</span>
            <span class="lang-ja">プロジェクト一覧に戻る</span>
          </a>
        </div>
      </div>
    </section>

    <!-- Parallax Image Grid -->
    <section class="py-32 px-6 md:px-12 flex justify-center bg-theme-alt">
      <div class="max-w-7xl w-auto grid grid-cols-1 md:grid-cols-3 gap-12 items-start">
        <div class="parallax-item translate-y-12 transition-transform duration-1000">
           <div class="aspect-[3/4] bg-theme/5 rounded-sm overflow-hidden mb-6">
             <div class="w-full h-full bg-gradient-to-br from-theme/10 to-theme/0 flex items-center justify-center p-12">
                <span class="text-xs uppercase tracking-widest text-theme-muted">Digital Art 01</span>
             </div>
           </div>
        </div>
        <div class="parallax-item -translate-y-12 transition-transform duration-1000">
           <div class="aspect-[3/4] bg-theme/5 rounded-sm overflow-hidden mb-6">
             <div class="w-full h-full bg-gradient-to-br from-theme/5 to-theme/10 flex items-center justify-center p-12">
                <span class="text-xs uppercase tracking-widest text-theme-muted">Imabari Life 02</span>
             </div>
           </div>
        </div>
        <div class="parallax-item translate-y-24 transition-transform duration-1000">
           <div class="aspect-[3/4] bg-theme/5 rounded-sm overflow-hidden mb-6">
             <div class="w-full h-full bg-gradient-to-br from-theme/10 to-theme/5 flex items-center justify-center p-12">
                <span class="text-xs uppercase tracking-widest text-theme-muted">Craftmanship 03</span>
             </div>
           </div>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>

<script is:inline>
  // Simple parallax implementation for the project page
  window.addEventListener('scroll', () => {
    const scroll = window.pageYOffset;
    
    // Hero BG parallax
    const bg = document.getElementById('parallax-bg');
    if (bg) {
      bg.style.transform = `translateY(${scroll * 0.4}px) scale(1.1)`;
    }

    // Grid items parallax
    const items = document.querySelectorAll('.parallax-item');
    items.forEach((item, index) => {
      const speed = (index + 1) * 0.1;
      const rect = item.getBoundingClientRect();
      const visible = rect.top < window.innerHeight && rect.bottom > 0;
      
      if (visible) {
        const offset = (window.innerHeight - rect.top) * speed;
        // Apply different directions for interest
        const direction = index % 2 === 0 ? 1 : -1;
        item.style.transform = `translateY(${offset * direction * 0.2}px)`;
      }
    });
  });

  // Video fade-in logic
  const video = document.getElementById('project-video');
  const loader = document.getElementById('video-loader');
  
  if (video && loader) {
    video.addEventListener('playing', () => {
      video.classList.remove('opacity-0');
      video.classList.add('opacity-60');
      loader.classList.add('opacity-0');
      setTimeout(() => loader.style.display = 'none', 1000);
    }, { once: true });

    // Fallback if event doesn't fire
    if (video.readyState >= 3) {
      video.classList.remove('opacity-0');
      video.classList.add('opacity-60');
      loader.classList.add('opacity-0');
      setTimeout(() => loader.style.display = 'none', 1000);
    }
  }
</script>

<style>
  main {
    font-family: var(--font-sans);
  }
  h1, h2 {
    font-family: var(--font-serif);
  }
  
  /* Dark mode (default) - black overlay, white text */
  .project-hero {
    background-color: black;
  }
  .hero-overlay {
    background: linear-gradient(to top, rgba(0, 0, 0, 0.9), rgba(0, 0, 0, 0.2), transparent);
  }
  .hero-text {
    color: white;
  }
  .hero-text-soft {
    color: rgba(255, 255, 255, 0.8);
  }
  .hero-text-muted {
    color: rgba(255, 255, 255, 0.5);
  }
  .hero-border {
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  /* Light mode - white overlay, dark text */
  :root[data-theme="light"] .project-hero {
    background-color: white;
  }
  :root[data-theme="light"] .hero-overlay {
    background: linear-gradient(to top, rgba(255, 255, 255, 0.9), rgba(255, 255, 255, 0.3), transparent);
  }
  :root[data-theme="light"] .hero-text {
    color: black;
  }
  :root[data-theme="light"] .hero-text-soft {
    color: rgba(0, 0, 0, 0.8);
  }
  :root[data-theme="light"] .hero-text-muted {
    color: rgba(0, 0, 0, 0.5);
  }
  :root[data-theme="light"] .hero-border {
    border-color: rgba(0, 0, 0, 0.1);
  }

  /* Theme-aware Top Gradient */
  .hero-top-gradient {
    transition: background 1s ease;
  }

  /* Dark theme: subtle dark gradient */
  :root:not([data-theme="light"]) .hero-top-gradient {
    background: linear-gradient(to bottom, 
      rgba(0, 0, 0, 0.45) 0%, 
      rgba(0, 0, 0, 0.15) 50%, 
      transparent 100%
    );
  }

  /* Light theme: smooth eased vertical wash */
  :root[data-theme="light"] .hero-top-gradient {
    background: linear-gradient(
      to bottom,
      rgba(255, 255, 255, 0.6) 0%,
      rgba(255, 255, 255, 0.4) 20%,
      rgba(255, 255, 255, 0.2) 45%,
      rgba(255, 255, 255, 0.05) 70%,
      rgba(255, 255, 255, 0) 100%
    );
  }

  @media (max-width: 768px) {
    :root[data-theme="light"] .hero-top-gradient {
      /* Just a slightly deeper vertical fade for mobile, no corner shapes */
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.75) 0%,
        rgba(255, 255, 255, 0.4) 35%,
        rgba(255, 255, 255, 0.1) 70%,
        rgba(255, 255, 255, 0) 100%
      );
    }
  }
</style>
