---
interface Props {
  title?: string;
  subtitle?: string;
}

import LogoGlobe from './LogoGlobe.astro';

const { title = "Digital-first Design Agency", subtitle = "We craft immersive digital experiences" } = Astro.props;
---

<section class="relative h-screen w-full flex items-center justify-center overflow-hidden">

  
  <!-- Background Video/Image -->
  <div class="absolute inset-0">
    <video
      id="hero-video"
      autoplay
      muted
      loop
      playsinline
      poster="/graphics/yuaheader-placeholder.png"
      class="w-full h-full object-cover"
    >
      <source id="hero-video-source" src="/video/loopingyua.mp4" type="video/mp4" />
      <img 
        src="/graphics/yuaheader-placeholder.png" 
        alt="" 
        class="w-full h-full object-cover"
      />
    </video>
    <div class="absolute inset-0 bg-black/30"></div>
  </div>
  
  <!-- Content -->
  <div class="absolute bottom-12 left-6 md:bottom-16 md:left-12 z-10 w-full max-w-[85vw] md:max-w-[40vw] flex flex-col items-start">
    <!-- News Link with Caterpillar -->
    <a href="/news" class="group flex items-center gap-3 mb-6 hover:opacity-100 transition-all">
      <div class="caterpillar-container relative w-12 h-8">
        <svg viewBox="0 0 100 60" class="w-full h-full drop-shadow-sm transition-transform group-hover:scale-110 group-hover:-rotate-6">
          <!-- Caterpillar Body -->
          <circle cx="20" cy="40" r="12" fill="#9DD67B" />
          <circle cx="35" cy="40" r="12" fill="#A8E086" />
          <circle cx="50" cy="40" r="12" fill="#B3EB91" />
          <circle cx="65" cy="40" r="14" fill="#B3EB91" /> <!-- Head -->
          <!-- Face -->
          <circle cx="68" cy="36" r="2" fill="#333" />
          <circle cx="78" cy="36" r="2" fill="#333" />
          <path d="M70 44 Q73 48 76 44" stroke="#333" stroke-width="2" fill="none" class="smile" />
          <!-- Antennas -->
          <line x1="68" x2="65" y1="28" y2="15" stroke="#9DD67B" stroke-width="2" />
          <line x1="75" x2="78" y1="28" y2="15" stroke="#9DD67B" stroke-width="2" />
          <!-- Bugle/Horn -->
          <g class="bugle transition-all duration-300 group-hover:translate-x-1">
            <path d="M78 40 L95 30 L95 50 Z" fill="#FFD700" stroke="#B8860B" stroke-width="1" />
            <rect x="76" y="38" width="10" height="4" fill="#FFD700" stroke="#B8860B" stroke-width="1" />
          </g>
        </svg>
        <!-- Sound waves -->
        <div class="absolute -right-2 top-2 opacity-0 group-hover:opacity-100 transition-opacity">
          <div class="sound-wave"></div>
          <div class="sound-wave delay-100"></div>
        </div>
      </div>
      <span class="text-[10px] md:text-xs uppercase tracking-[0.2em] font-bold text-white/80 group-hover:text-white border-b border-white/20 pb-1">
        <span class="lang-en">Read latest news</span>
        <span class="lang-ja">最新ニュースを読む</span>
      </span>
    </a>

    <!-- Logo & Wireframe Globe -->
    <LogoGlobe logoColor="white" className="relative w-full h-auto" />
    <h1 class="sr-only">
      <span class="lang-en">{title}</span>
      <span class="lang-ja">デジタル・ファーストのデザイン・エージェンシー</span>
    </h1>
  </div>
  
  <!-- Scroll Indicator -->
  <div class="absolute bottom-12 right-6 md:right-12 flex flex-col items-center gap-4 z-20">
    <span class="text-[10px] tracking-[0.2em] uppercase text-white/60 vertical-text font-bold">
      <span class="lang-en">Scroll</span>
      <span class="lang-ja">スクロール</span>
    </span>
    <div class="w-px h-24 bg-gradient-to-b from-white/60 to-transparent relative overflow-hidden">
      <div class="absolute top-0 left-0 w-full h-1/2 bg-white scroll-line-anim"></div>
    </div>
  </div>
</section>

<style>
  .vertical-text {
    writing-mode: vertical-rl;
    text-orientation: mixed;
  }

  .scroll-line-anim {
    animation: scroll-line 2s cubic-bezier(0.76, 0, 0.24, 1) infinite;
  }

  .sound-wave {
    width: 2px;
    height: 10px;
    background: #FFD700;
    display: inline-block;
    border-radius: 2px;
    animation: wave 1s ease-in-out infinite;
    margin-right: 2px;
  }

  .delay-100 { animation-delay: 0.1s; }

  @keyframes wave {
    0%, 100% { height: 10px; transform: translateY(0); }
    50% { height: 18px; transform: translateY(-4px); }
  }

  .group:hover .caterpillar-container svg {
    animation: wiggle 0.5s ease-in-out infinite alternate;
  }

  @keyframes wiggle {
    from { transform: rotate(-6deg) translateY(0); }
    to { transform: rotate(-2deg) translateY(-2px); }
  }

  @keyframes scroll-line {
    0% {
      transform: translateY(-100%);
    }
    50% {
      transform: translateY(200%);
    }
    100% {
      transform: translateY(200%);
    }
  }
</style>

<script>
  const video = document.getElementById('hero-video') as HTMLVideoElement;
  const source = document.getElementById('hero-video-source') as HTMLSourceElement;
  
  const updateVideoSource = () => {
    const isLight = document.documentElement.getAttribute('data-theme') === 'light';
    const newSrc = isLight ? '/video/lightloop2.mp4' : '/video/loopingyua.mp4';
    
    if (source && source.getAttribute('src') !== newSrc) {
      source.setAttribute('src', newSrc);
      video.load();
      video.play();
    }
  };

  // Initial check
  updateVideoSource();

  // Watch for theme changes
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'attributes' && mutation.attributeName === 'data-theme') {
        updateVideoSource();
      }
    });
  });

  observer.observe(document.documentElement, {
    attributes: true,
    attributeFilter: ['data-theme']
  });
</script>
